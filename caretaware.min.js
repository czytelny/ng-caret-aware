/**
 * Copyright (c) 2015, Leo Di Donato <leodidonato@gmail.com>
 * caretaware.min.js - AngularJS directive for caret aware elements
 * @version 0.2.0
 * @link http://github.com/leodido/ng-caret-aware
 * @license MIT
 */
(function(){function n(f,g,p){function h(a){var c=(b.value||'').replace(/\r/g,'').length,d=~~a;0>d?d=c+a:d>c&&(d=c);return d}var b=g[0],m;g='setSelectionRange'in b||'selectionStart'in b;var r='createTextRange'in b||'selection'in document,e=this,k,l;switch(!0){case g:g=function(){return k().start};k=function(){var a=b.selectionStart,c=b.selectionEnd,d=c-a;return{start:a,end:c,length:d,text:b.value.substr(a,d)}};l=function(a){a=h(a);b.focus();b.setSelectionRange(a,a);f[e.a()]=a};break;case r:g=function(){b.focus();
var a=document.selection.createRange(),c=document.selection.createRange().text.length;a.moveStart('character',-b.value.length);return a.text.length-c};k=function(){b.focus();var a=document.selection.createRange();if(null===a)return{start:0,end:b.value.length,length:0};var c=b.createTextRange(),d=c.duplicate();c.moveToBookmark(a.getBookmark());d.setEndPoint('EndToStart',c);c=d.text.length;a=a.text;d=a.length;return{start:c,end:c+d,length:d,text:a}};l=function(a){a=h(a);var c=b.createTextRange();c.move('character',
a);c.select();f[e.a()]=a};break;default:g=function(){return 0},k=function(){return{start:0,end:0,length:0,text:''}},l=function(){}}m=p.caretAware||'caret';f[m]=0;e.a=function(){return m};e.c=function(a){if(!isNaN(parseFloat(a))&&isFinite(a))return l(a),e;throw new TypeError('Position MUST be numeric.');};e.b=g;e.getSelection=k;e.getNamespace=e.a;e.setPosition=e.c;e.getPosition=e.b}n.$inject=['$scope','$element','$attrs'];function q(){}q.prototype.link=function(f,g,p,h){g.on('keydown keyup click',function(){f.$evalAsync(function(){f[h.a()]=h.b()})});f.$watch(function(){return f[h.a()]},function(b){h.b()!==b&&h.c(b)});f.$on('$destroy',function(){delete f[h.a()];g.off('keydown keyup click')})};angular.module('leodido.caretAware',[]).directive('caretAware',function(){var f=new q;return{restrict:'AC',require:'caretAware',controller:n,link:f.link}});})();
