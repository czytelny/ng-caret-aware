/**
 * Copyright (c) 2015, Leo Di Donato <leodidonato@gmail.com>
 * caretaware.min.js - AngularJS directive for caret aware elements
 * @version 0.2.0
 * @link http://github.com/leodido/ng-caret-aware
 * @license MIT
 */
(function(){function n(f,g,p){function h(a){var c=(b.value||'').replace(/\r/g,'').length,d=~~a;0>d?d=c+a:d>c&&(d=c);return d}var b=g[0],k;g='setSelectionRange'in b||'selectionStart'in b;var r='createTextRange'in b||'selection'in document,e=this,l,m;switch(!0){case g:g=function(){return l().start};l=function(){var a=b.selectionStart,c=b.selectionEnd,d=c-a;return{start:a,end:c,length:d,text:b.value.substr(a,d)}};m=function(a){a=h(a);b.focus();b.setSelectionRange(a,a);f[e.a()]=a};break;case r:g=function(){b.focus();
var a=document.selection.createRange(),c=document.selection.createRange().text.length;a.moveStart('character',-b.value.length);return a.text.length-c};l=function(){b.focus();var a=document.selection.createRange();if(null===a)return{start:0,end:b.value.length,length:0};var c=b.createTextRange(),d=c.duplicate();c.moveToBookmark(a.getBookmark());d.setEndPoint('EndToStart',c);c=d.text.length;a=a.text;d=a.length;return{start:c,end:c+d,length:d,text:a}};m=function(a){a=h(a);var c=b.createTextRange();c.move('character',
a);c.select();f[e.a()]=a};break;default:g=function(){return 0},l=function(){return{start:0,end:0,length:0,text:''}},m=function(){}}k=p.caretAware||'caret';f[k]=0;e.a=function(){return k};e.c=function(a){if(!isNaN(parseFloat(a))&&isFinite(a))return m(a),e;throw new TypeError('Position MUST be numeric.');};e.b=g;e.getSelection=l;e.getNamespace=e.a;e.setPosition=e.c;e.getPosition=e.b}n.$inject=['$scope','$element','$attrs'];function q(){}q.prototype.link=function(f,g,p,h){var b=g.on('keydown keyup click',function(){f.$evalAsync(function(){f[h.a()]=h.b()})}),k=f.$watch(function(){return f[h.a()]},function(b){h.b()!==b&&h.c(b)});f.$on('$destroy',function(){b();k()})};angular.module('leodido.caretAware',[]).directive('caretAware',function(){var f=new q;return{restrict:'AC',require:'caretAware',controller:n,link:f.link}});})();
